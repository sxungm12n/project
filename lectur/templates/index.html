<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¼í•™ìœ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css/github-markdown.min.css">
    <style>
        :root {
            --primary-blue: #e3f2fd;
            --secondary-blue: #bbdefb;
            --accent-blue: #90caf9;
            --text-color: #2c3e50;
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow-color: rgba(0, 0, 0, 0.1);
            --gradient-start: #64b5f6;
            --gradient-end: #1976d2;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        body {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            font-family: 'Noto Sans KR', sans-serif;
            min-height: 100vh;
            animation: fadeIn 0.5s ease-out;
            color: var(--text-color);
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
            animation: fadeIn 0.8s ease-out;
        }
        .chat-container {
            background-color: var(--card-bg);
            border-radius: 30px;
            padding: 20px;
            height: 4000px;
            display: flex;
            flex-direction: column;
            position: relative;
            max-width: 400px;
            margin: 0 auto;
            border: 12px solid #333;
            overflow: hidden;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            background: linear-gradient(135deg, #f5f7fa, #e4e8eb);
        }
        .chat-container::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 20px;
            background-color: #333;
            border-radius: 10px;
            z-index: 2;
        }
        .chat-container::after {
            content: '';
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 5px;
            background-color: #333;
            border-radius: 5px;
            z-index: 2;
        }
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 8px;
            margin: 10px 0 5px 0;
            border-radius: 20px;
            background-color: transparent;
            border: none;
            max-height: 3800px;
            position: relative;
            z-index: 1;
            backdrop-filter: blur(5px);
            padding-bottom: 80px;
        }
        .message {
            margin-bottom: 10px;
            padding: 12px 15px;
            border-radius: 18px;
            max-width: 85%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease-out;
            line-height: 1.5;
            font-size: 0.95rem;
            position: relative;
            font-family: 'Segoe UI', 'Noto Sans KR', sans-serif;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }
        .message-content {
            flex: 1;
            padding-right: 30px;
        }
        .user-message {
            background: linear-gradient(135deg, #6c9eff, #4a7dff);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
            font-weight: 500;
            box-shadow: 0 4px 8px rgba(108, 158, 255, 0.3);
        }
        .assistant-message {
            background: white;
            margin-right: auto;
            border-bottom-left-radius: 5px;
            color: #333;
            font-weight: 400;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .chat-input {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px;
            background-color: white;
            border-radius: 20px;
            margin: 8px;
            position: relative;
            z-index: 1;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .input-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .input-container input {
            width: 100%;
            border-radius: 15px;
            padding: 10px 15px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background-color: #f8f9fa;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        .button-container {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }
        .button-container button {
            border-radius: 15px;
            padding: 10px 15px;
            background: linear-gradient(135deg, #6c9eff, #4a7dff);
            border: none;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(108, 158, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }
        .button-container button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(108, 158, 255, 0.4);
        }
        .mic-button {
            background: linear-gradient(135deg, #1e88e5, #1565c0);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }
        .chat-input .action-button {
            background: white;
            color: #6c9eff;
            border: 2px solid #6c9eff;
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .chat-input .action-button:hover {
            background: linear-gradient(135deg, #6c9eff, #4a7dff);
            color: white;
        }
        .chat-input .file-input {
            display: none;
        }
        .quick-actions {
            display: flex;
            gap: 4px;
            margin: 6px 0;
            padding: 0 4px;
            justify-content: center;
        }
        .quick-actions button {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 3px;
            font-weight: 500;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            border: 1px solid;
            background: white;
            min-width: 60px;
            justify-content: center;
        }
        .quick-actions button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
        .quick-actions button i {
            font-size: 0.75em;
            transition: transform 0.2s ease;
        }
        .quick-actions .btn-outline-primary {
            color: #0d6efd;
            border-color: #0d6efd;
        }
        
        .quick-actions .btn-outline-primary:hover {
            background: #0d6efd;
            color: white;
        }
        
        .quick-actions .btn-outline-info {
            color: #0dcaf0;
            border-color: #0dcaf0;
        }
        
        .quick-actions .btn-outline-info:hover {
            background: #0dcaf0;
            color: white;
        }

        .quick-actions .btn-outline-success {
            color: #198754;
            border-color: #198754;
        }
        
        .quick-actions .btn-outline-success:hover {
            background: #198754;
            color: white;
        }

        .quick-actions .btn-outline-warning {
            color: #ffc107;
            border-color: #ffc107;
        }
        
        .quick-actions .btn-outline-warning:hover {
            background: #ffc107;
            color: white;
        }
        .speaker-icon {
            position: absolute;
            right: -30px;
            bottom: 0;
            cursor: pointer;
            color: #64b5f6;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            padding: 6px;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 1;
        }
        .speaker-icon:hover {
            transform: scale(1.1);
            color: #1e88e5;
            background: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        .speaker-icon i {
            font-size: 1em;
        }
        .summary-container, .news-container {
            background-color: white;
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .news-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .news-item:last-child {
            border-bottom: none;
        }
        .news-item a {
            color: var(--accent-blue);
            text-decoration: none;
            font-weight: 500;
        }
        .news-date {
            font-size: 0.8em;
            color: #666;
        }
        @media (max-width: 768px) {
            .container {
                padding: 8px;
            }
            .chat-container {
                height: 500px;
                max-width: 350px;
            }
            .message {
                max-width: 90%;
                font-size: 0.9rem;
            }
            .chat-input input {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
            .chat-input button {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            .quick-actions button {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
        }
        .upload-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .file-upload-container {
            margin-top: 15px;
        }

        .upload-type-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .upload-type-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #f0f0f0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .upload-type-btn i {
            font-size: 1.1em;
        }

        .upload-type-btn.active {
            background: linear-gradient(135deg, #1e88e5, #1565c0);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(30, 136, 229, 0.4);
        }

        .upload-info {
            margin-bottom: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .upload-box {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-box:hover {
            border-color: #1e88e5;
            background: #f8f9fa;
        }

        .upload-box i {
            font-size: 48px;
            color: #1e88e5;
            margin-bottom: 10px;
        }
        .result-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 30px var(--shadow-color);
            margin-bottom: 30px;
            height: 800px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease-out;
            color: black;
        }
        .chat-section {
            background: var(--card-bg);
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 8px 30px var(--shadow-color);
            height: 600px;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease-out;
            overflow: hidden;
        }
        .loading-message {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            background-color: white;
            border-radius: 20px;
            margin-bottom: 15px;
            max-width: 85%;
            margin-right: auto;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .loading-dots {
            display: flex;
            gap: 8px;
        }
        .loading-dot {
            width: 8px;
            height: 8px;
            background: #1e88e5;
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }
        .loading-dot:nth-child(1) { animation-delay: 0s; }
        .loading-dot:nth-child(2) { animation-delay: 0.2s; }
        .loading-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        .download-btn {
            background: linear-gradient(135deg, var(--accent-blue), #64b5f6);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            margin-top: 15px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(144, 202, 249, 0.4);
        }
        .status-message {
            display: none;
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.9);
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: linear-gradient(135deg, var(--accent-blue), #64b5f6);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            display: none;
            box-shadow: 0 8px 20px var(--shadow-color);
            animation: fadeIn 0.3s ease-out;
        }
        .section-title {
            color: #2c3e50;
            margin-bottom: 30px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.5rem;
        }
        .section-title i {
            font-size: 1.6em;
            color: #64b5f6;
            background: linear-gradient(135deg, #64b5f6, #1e88e5);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        h1 {
            color: var(--text-color);
            text-shadow: 0 2px 4px var(--shadow-color);
            font-weight: 700;
            margin-bottom: 2rem;
            animation: float 3s ease-in-out infinite;
            text-align: center;
            font-size: 2.5rem;
            padding: 20px 0;
        }
        .form-control {
            border-radius: 15px;
            padding: 12px 20px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .form-control:focus {
            border-color: #64b5f6;
            box-shadow: 0 0 0 0.2rem rgba(100, 181, 246, 0.25);
            transform: translateY(-2px);
        }
        .btn-primary {
            background: linear-gradient(135deg, #64b5f6, #1e88e5);
            border: none;
            border-radius: 15px;
            padding: 12px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(100, 181, 246, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(100, 181, 246, 0.4);
        }
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í„°ë§ˆì´ì§• */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--gradient-end);
        }
        .markdown-body {
            color: black;
        }
        .news-item {
            margin: 10px 0;
                padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        
        .news-item:hover {
            background-color: #e9ecef;
        }
        
        .news-item a {
            color: #0066cc;
            text-decoration: none;
            font-weight: 500;
        }
        
        .news-item a:hover {
            text-decoration: underline;
        }
        
        h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        .quick-actions {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            padding: 0 10px;
        }
        
        .quick-actions button {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .quick-actions button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .quick-actions .btn-outline-primary {
            color: #0d6efd;
            border-color: #0d6efd;
        }
        
        .quick-actions .btn-outline-primary:hover {
            background-color: #0d6efd;
            color: white;
        }
        
        .quick-actions .btn-outline-info {
            color: #0dcaf0;
            border-color: #0dcaf0;
        }
        
        .quick-actions .btn-outline-info:hover {
            background-color: #0dcaf0;
            color: white;
        }
        .summary-container {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .summary-content {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            line-height: 1.6;
            font-size: 0.95rem;
        }
        
        .keywords {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        
        .keyword-badge {
            background-color: #e3f2fd;
            color: #1976d2;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
        }
        
        .news-item {
            background-color: white;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            transition: all 0.3s ease;
        }
        
        .news-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .news-keyword {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
        }
        .keyword-analysis {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 15px 0;
        }
        
        .keyword-category {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .keyword-category h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .keyword-badge {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            margin: 3px;
            display: inline-block;
        }
        
        .keyword-badge.concept {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .keyword-badge.field {
            background-color: #f3e5f5;
            color: #7b1fa2;
        }
        
        .keyword-badge.search {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .academic-sources {
            margin: 15px 0;
        }
        
        .academic-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .academic-item h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .academic-content {
            line-height: 1.6;
            color: #555;
        }
        
        .news-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
                padding: 20px;
            background: linear-gradient(135deg, #64b5f6, #1e88e5);
            border-radius: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 350px;
            margin: 0 auto 30px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .logo-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shine 3s infinite;
        }
        .logo {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            transform: rotate(-5deg);
            animation: float 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
            padding: 8px;
            transition: all 0.3s ease;
        }
        .logo:hover {
            transform: rotate(-5deg) scale(1.05);
        }
        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 0;
        }
        .logo-text {
            font-size: 2.2rem;
            font-weight: 800;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            animation: float 3s ease-in-out infinite;
            animation-delay: 0.2s;
            position: relative;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        .logo-text:hover {
            transform: translateY(-5px);
        }
        .logo-text::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
            animation: wave 2s infinite;
        }
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #64b5f6, #1e88e5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeOut 1s ease-out forwards;
            animation-delay: 2s;
        }
        .splash-logo {
            width: 300px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
            box-shadow: 0 8px 20px rgba(30, 136, 229, 0.4);
            transform: rotate(-5deg);
            background: white;
            border-radius: 30px;
            padding: 20px;
        }
        .splash-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 0;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }
        .splash-text {
            font-size: 3.5rem;
            font-weight: 800;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            animation: float 3s ease-in-out infinite;
            animation-delay: 0.2s;
            letter-spacing: 3px;
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }
        @keyframes shine {
            0% {
                transform: translateX(-100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) rotate(45deg);
            }
        }
        @keyframes wave {
            0% {
                transform: scaleX(0);
                opacity: 0;
            }
            50% {
                transform: scaleX(1);
                opacity: 1;
            }
            100% {
                transform: scaleX(0);
                opacity: 0;
            }
        }
        /* ì–¸ì–´ ì„ íƒ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
        .language-menu {
            position: absolute;
            right: 0;
            top: 100%;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            z-index: 1000;
            padding: 2px 0;
            margin-top: 2px;
            width: fit-content;
            min-width: unset;
        }
        
        .language-menu.show {
            display: block;
        }
        
        .language-option {
            padding: 2px 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            font-size: 0.65rem;
            color: #333;
            display: flex;
            align-items: center;
            gap: 2px;
            justify-content: center;
            min-width: unset;
            width: fit-content;
        }
        
        .language-option:hover {
            background-color: #f0f0f0;
            transform: translateX(1px);
        }

        .language-option::before {
            content: 'ğŸŒ';
            font-size: 0.65em;
        }

        .mic-button {
            background: linear-gradient(135deg, #1e88e5, #1565c0);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .mic-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(30, 136, 229, 0.4);
        }

        .mic-button.recording {
            background: linear-gradient(135deg, #e53935, #c62828);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .upload-button {
            margin-top: 15px;
            padding: 12px 25px;
            background: linear-gradient(135deg, #1e88e5, #1565c0);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(30, 136, 229, 0.4);
        }

        .upload-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .upload-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            display: none;
        }

        .upload-status.success {
            display: block;
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }

        .upload-status.error {
            display: block;
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }

        .result-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .result-section h4 {
            margin-bottom: 15px;
            color: #1565c0;
        }

        .result-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .supported-formats {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 5px;
        }

        .supported-formats span {
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .supported-formats i {
            color: #1e88e5;
        }

        .action-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            margin: 0 5px;
        }

        .action-button:hover {
            background: linear-gradient(135deg, #357abd, #2a5f94);
            transform: translateY(-2px);
        }

        .action-button i {
            font-size: 16px;
        }

        .quick-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
        }

        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-container {
            text-align: center;
            padding: 20px;
        }

        .search-result {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .search-result h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .search-result a {
            color: #007bff;
            text-decoration: none;
            font-weight: 500;
        }

        .search-result a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="splash-screen">
        <div class="splash-logo">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="ê³¼í•™ìŒ¤ ë¡œê³ ">
        </div>
        <div class="splash-text">ê³¼í•™ìŒ¤</div>
    </div>
    <div class="container">
        <div class="logo-container">
            <div class="logo">
                <img src="{{ url_for('static', filename='logo-ë³µì‚¬ë³¸.png') }}" alt="ê³¼í•™ìŒ¤ ë¡œê³ ">
            </div>
            <div class="logo-text">ê³¼í•™ìŒ¤</div>
        </div>
        
        <h1 class="text-center mb-4"></h1>
        
        <div class="row">
            <div class="col-md-8">
                <div class="upload-section">
                    <h3>íŒŒì¼ ì—…ë¡œë“œ</h3>
                    <p>ê°•ì˜ ë‚´ìš©ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                    <div class="file-upload-container">
                        <div class="upload-type-selector">
                            <button class="upload-type-btn active" data-type="audio">
                                <i class="fas fa-microphone"></i> ìŒì„± íŒŒì¼
                            </button>
                            <button class="upload-type-btn" data-type="document">
                                <i class="fas fa-file-alt"></i> ë¬¸ì„œ íŒŒì¼
                            </button>
                            </div>
                        <div class="upload-info audio-info">
                            <p>ì§€ì› í˜•ì‹: WAV</p>
                        </div>
                        <div class="upload-info document-info" style="display: none;">
                            <p>ì§€ì› í˜•ì‹:</p>
                            <div class="supported-formats">
                                <span><i class="fas fa-file-pdf"></i> PDF</span>
                                <span><i class="fas fa-file-excel"></i> Excel (XLSX, XLS)</span>
                                <span><i class="fas fa-file-word"></i> Word (DOCX)</span>
                                <span><i class="fas fa-file-powerpoint"></i> PowerPoint (PPTX)</span>
                                <span><i class="fas fa-file-alt"></i> Text (TXT)</span>
                            </div>
                        </div>
                        <form id="uploadForm">
                            <input type="file" id="fileInput" accept=".wav" style="display: none;">
                            <div class="upload-box" id="dropZone">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒ</p>
                                <p id="selectedFileName" style="margin-top: 10px; color: #1e88e5; font-weight: 500; display: none;"></p>
                            </div>
                            <button type="submit" class="upload-button">
                                <i class="fas fa-upload"></i> ì—…ë¡œë“œ
                        </button>
                        </form>
                        <div id="uploadStatus" class="upload-status"></div>
                    </div>
            </div>

                <div class="result-section" id="resultSection" style="display: none;">
                    <h3 class="section-title"><i class="fas fa-file-alt"></i> ë³€í™˜ ê²°ê³¼</h3>
                            <div class="mb-3">
                        <h6>ğŸ“ í…ìŠ¤íŠ¸:</h6>
                        <div id="textResult" class="border p-3 bg-light markdown-body"></div>
                        <button class="download-btn" onclick="downloadText()">
                            <i class="fas fa-download"></i> í…ìŠ¤íŠ¸ ë‹¤ìš´ë¡œë“œ
                        </button>
                            </div>
                    <div class="mb-3">
                        <h6>ğŸ“‹ ìš”ì•½:</h6>
                        <div id="summaryResult" class="border p-3 bg-light markdown-body"></div>
                        <button class="download-btn" onclick="downloadSummary()">
                            <i class="fas fa-download"></i> ìš”ì•½ ë‹¤ìš´ë¡œë“œ
                        </button>
                </div>
            </div>
        </div>

            <div class="col-md-4">
                <div class="chat-section">
                    <h3 class="section-title"><i class="fas fa-robot"></i> ì±—ë´‡</h3>
                    <div class="chat-messages" id="chatMessages"></div>
                    <div class="quick-actions">
                        <button onclick="summarizeLastQuestion()" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-file-alt"></i> ìš”ì•½
                        </button>
                        <button onclick="searchWiki()" class="btn btn-sm btn-outline-info">
                            <i class="fas fa-search"></i> ê²€ìƒ‰
                        </button>
                        <button class="btn btn-sm btn-outline-success" id="translateBtn">
                            <i class="fas fa-language"></i> ë²ˆì—­
                        </button>
                        <button onclick="generateImage()" class="btn btn-sm btn-outline-warning">
                            <i class="fas fa-image"></i> ê·¸ë¦¼
                        </button>
                    </div>
                    <div class="chat-input">
                        <div class="input-container">
                            <input type="text" id="userInput" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...">
                            <div class="button-container">
                                <button id="sendButton">
                                    <i class="fas fa-paper-plane"></i>
                        </button>
                                <button id="micButton" class="mic-button">
                                    <i class="fas fa-microphone"></i>
                        </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <div id="searchResult" class="search-result" style="display: none;">
        <h3>ìœ„í‚¤ë°±ê³¼ ê²€ìƒ‰ ê²°ê³¼</h3>
        <div id="wikiLink"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // ì±„íŒ… ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸
        const chatMessages = document.getElementById("chatMessages");
        const userInput = document.getElementById("userInput");

        // ì´ˆê¸° ë©”ì‹œì§€ ì¶”ê°€
        addMessage("ì•ˆë…•í•˜ì„¸ìš”! ê³¼í•™ìŒ¤ì…ë‹ˆë‹¤. ê³¼í•™ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹ ê°€ìš”? ì œê°€ ì¹œì ˆí•˜ê²Œ ì„¤ëª…í•´ë“œë¦´ê²Œìš”. ì–´ë–¤ ê²ƒì´ë“  í¸í•˜ê²Œ ë¬¼ì–´ë³´ì„¸ìš”!", "assistant");
        addMessage("ê°•ì˜ ë‚´ìš©ì„ ì—…ë¡œë“œí•˜ì‹œë©´ ì œê°€ ê·¸ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€í•´ë“œë¦´ê²Œìš”!", "assistant");

        // ì‘ë‹µ í¬ë§·íŒ… í•¨ìˆ˜ ì¶”ê°€
        function formatResponse(text) {
            // ìˆ˜í•™ì  í‘œí˜„ì„ ë” ì¹œê·¼í•œ ì„¤ëª…ìœ¼ë¡œ ë³€ê²½
            text = text.replace(/\\[a-zA-Z]+/g, function(match) {
                switch(match) {
                    case '\\alpha': return 'ì•ŒíŒŒ';
                    case '\\beta': return 'ë² íƒ€';
                    case '\\gamma': return 'ê°ë§ˆ';
                    case '\\theta': return 'ì„¸íƒ€';
                    case '\\lambda': return 'ëŒë‹¤';
                    case '\\mu': return 'ë®¤';
                    case '\\sigma': return 'ì‹œê·¸ë§ˆ';
                    case '\\pi': return 'íŒŒì´';
                    case '\\omega': return 'ì˜¤ë©”ê°€';
                    default: return match;
                }
            });

            // ì „ë¬¸ ìš©ì–´ë¥¼ ë” ì‰¬ìš´ ì„¤ëª…ìœ¼ë¡œ ë³€ê²½
            text = text.replace(/ë¼ê·¸ë‘ì£¼/g, 'ë¼ê·¸ë‘ì£¼(ë¬¼ì²´ì˜ ìš´ë™ì„ ì„¤ëª…í•˜ëŠ” ë°©ë²•)');
            text = text.replace(/ë¯¸ë¶„/g, 'ë¯¸ë¶„(ë³€í™”ìœ¨ì„ êµ¬í•˜ëŠ” ë°©ë²•)');
            text = text.replace(/ì ë¶„/g, 'ì ë¶„(ë©´ì ì„ êµ¬í•˜ëŠ” ë°©ë²•)');
            text = text.replace(/ë²¡í„°/g, 'ë²¡í„°(í¬ê¸°ì™€ ë°©í–¥ì„ ê°€ì§„ ì–‘)');
            text = text.replace(/ìŠ¤ì¹¼ë¼/g, 'ìŠ¤ì¹¼ë¼(í¬ê¸°ë§Œ ìˆëŠ” ì–‘)');

            // ì„ ìƒë‹˜ë‹¤ìš´ í†¤ìœ¼ë¡œ ë¬¸ì¥ ì‹œì‘
            text = text.replace(/^/, 'ì, ì´ì œ ì„¤ëª…í•´ë³¼ê²Œìš”.\n\n');
            
            // ë¬¸ì¥ ëì— ì¹œê·¼í•œ í‘œí˜„ ì¶”ê°€
            text = text.replace(/\.$/g, 'ì…ë‹ˆë‹¤. ì´í•´ê°€ ë˜ì—ˆë‚˜ìš”?');
            
            return text;
        }

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            // ì…ë ¥ì°½ê³¼ ë²„íŠ¼ ë¹„í™œì„±í™”
            userInput.disabled = true;
            document.querySelector('.chat-input button').disabled = true;
            document.querySelector('.quick-actions button').disabled = true;

            // ë©”ì‹œì§€ ì—…ë¡œë“œ
            try {
                const uploadResponse = await fetch("/upload_message", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        message: message
                    }),
                });

                const uploadData = await uploadResponse.json();
                if (!uploadData.success) {
                    console.error("ë©”ì‹œì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:", uploadData.error);
                }
            } catch (error) {
                console.error("ë©”ì‹œì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜:", error);
            }

            addMessage(message, "user");
            userInput.value = "";
            
            // ë¡œë”© ë©”ì‹œì§€ ì¶”ê°€
            const loadingMessage = document.createElement("div");
            loadingMessage.className = "loading-message";
            loadingMessage.innerHTML = `
                <span>ë‹µë³€ì„ ì¤€ë¹„í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤</span>
                <div class="loading-dots">
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                </div>
            `;
            chatMessages.appendChild(loadingMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                const response = await fetch("/chat", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        messages: [{ role: "user", content: message }],
                    }),
                });

                const data = await response.json();
                
                // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                loadingMessage.remove();

                if (data.response) {
                    const formattedResponse = formatResponse(data.response);
                    addMessage(formattedResponse, "assistant");
                } else if (data.error) {
                    addMessage("ì•„, ì£„ì†¡í•©ë‹ˆë‹¤. ì ì‹œ ë¬¸ì œê°€ ë°œìƒí–ˆë„¤ìš”. ë‹¤ì‹œ ì‹œë„í•´ë³¼ê¹Œìš”?", "assistant");
                } else {
                    addMessage("ì£„ì†¡í•©ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.", "assistant");
                }
            } catch (error) {
                loadingMessage.remove();
                addMessage("ì•„, ì£„ì†¡í•©ë‹ˆë‹¤. ì—°ê²°ì— ë¬¸ì œê°€ ìƒê²¼ë„¤ìš”. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.", "assistant");
                console.error("ì˜¤ë¥˜:", error);
            } finally {
                // ì…ë ¥ì°½ê³¼ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                userInput.disabled = false;
                document.querySelector('.chat-input button').disabled = false;
                document.querySelector('.quick-actions button').disabled = false;
                userInput.focus();
            }
        }

        function addMessage(text, sender) {
            const messageDiv = document.createElement("div");
            messageDiv.className = `message ${sender}-message`;
            
            // ë©”ì‹œì§€ ë‚´ìš© ì»¨í…Œì´ë„ˆ ìƒì„±
            const messageContent = document.createElement("div");
            messageContent.className = "message-content";
            messageContent.innerHTML = marked.parse(text);
            
            messageDiv.appendChild(messageContent);
            
            // ìŠ¤í”¼ì»¤ ì•„ì´ì½˜ ì¶”ê°€ (assistant ë©”ì‹œì§€ì—ë§Œ)
            if (sender === 'assistant') {
                const speakerIcon = document.createElement("div");
                speakerIcon.className = "speaker-icon";
                speakerIcon.innerHTML = '<i class="fas fa-volume-up"></i>';
                speakerIcon.style.cursor = "pointer";
                speakerIcon.style.color = "#64b5f6";
                speakerIcon.style.transition = "all 0.3s ease";
                
                // í˜¸ë²„ íš¨ê³¼
                speakerIcon.addEventListener('mouseover', () => {
                    speakerIcon.style.transform = "scale(1.1)";
                    speakerIcon.style.color = "#1e88e5";
                });
                
                speakerIcon.addEventListener('mouseout', () => {
                    speakerIcon.style.transform = "scale(1)";
                    speakerIcon.style.color = "#64b5f6";
                });
                
                // TTS ê¸°ëŠ¥
                speakerIcon.addEventListener('click', async () => {
                    try {
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = text;
                        const plainText = tempDiv.textContent || tempDiv.innerText;
                        
                        const response = await fetch('/tts', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ text: plainText })
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.audio_url) {
                                const audio = new Audio(data.audio_url);
                                audio.play().catch(error => {
                                    console.error('ì˜¤ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜:', error);
                                    showToast('ì˜¤ë””ì˜¤ ì¬ìƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                                });
                            } else {
                                console.error('ì˜¤ë””ì˜¤ URLì´ ì—†ìŠµë‹ˆë‹¤.');
                                showToast('ì˜¤ë””ì˜¤ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                            }
                        } else {
                            const errorData = await response.json();
                            console.error('TTS ì˜¤ë¥˜:', errorData.error);
                            showToast('ìŒì„± ë³€í™˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        }
                    } catch (error) {
                        console.error('TTS ì˜¤ë¥˜:', error);
                        showToast('ìŒì„± ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                });
                
                messageDiv.appendChild(speakerIcon);
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // íŒŒì¼ ì—…ë¡œë“œ ê´€ë ¨ ë³€ìˆ˜
        const fileInput = document.getElementById('fileInput');
        const dropZone = document.getElementById('dropZone');
        const uploadTypeBtns = document.querySelectorAll('.upload-type-btn');
        const audioInfo = document.querySelector('.audio-info');
        const documentInfo = document.querySelector('.document-info');

        // ì—…ë¡œë“œ íƒ€ì… ì„ íƒ
        uploadTypeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                uploadTypeBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                const type = btn.dataset.type;
                if (type === 'audio') {
                    fileInput.accept = '.wav';
                    audioInfo.style.display = 'block';
                    documentInfo.style.display = 'none';
                } else {
                    fileInput.accept = '.txt,.docx,.pptx,.xlsx';
                    audioInfo.style.display = 'none';
                    documentInfo.style.display = 'block';
                }
            });
        });

        // íŒŒì¼ ë“œë¡­ ì´ë²¤íŠ¸
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#1e88e5';
            dropZone.style.background = '#f8f9fa';
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#ccc';
            dropZone.style.background = 'white';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#ccc';
            dropZone.style.background = 'white';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                updateSelectedFileName(files[0]);
            }
        });

        // í´ë¦­ìœ¼ë¡œ íŒŒì¼ ì„ íƒ
        dropZone.addEventListener('click', () => {
            fileInput.click();
        });

        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function updateSelectedFileName(file) {
            const selectedFileName = document.getElementById('selectedFileName');
            if (file) {
                selectedFileName.textContent = `ì„ íƒëœ íŒŒì¼: ${file.name}`;
                selectedFileName.style.display = 'block';
            } else {
                selectedFileName.style.display = 'none';
            }
        }

        // íŒŒì¼ ì…ë ¥ ë³€ê²½ ì´ë²¤íŠ¸
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                updateSelectedFileName(e.target.files[0]);
            }
        });

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        const uploadForm = document.getElementById('uploadForm');
        const uploadStatus = document.getElementById('uploadStatus');
        const resultSection = document.getElementById('resultSection');

        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const file = fileInput.files[0];
            if (!file) {
                showToast('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // íŒŒì¼ í¬ê¸° ì²´í¬ (100MB ì œí•œ)
            const maxSize = 100 * 1024 * 1024; // 100MB
            if (file.size > maxSize) {
                showToast('íŒŒì¼ í¬ê¸°ê°€ 100MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ì—…ë¡œë“œ ë²„íŠ¼ ë¹„í™œì„±í™” ë° ìƒíƒœ í‘œì‹œ
            const uploadButton = uploadForm.querySelector('button[type="submit"]');
            uploadButton.disabled = true;
            uploadButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ì²˜ë¦¬ì¤‘...';
            
            // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
            uploadStatus.className = 'upload-status';
            uploadStatus.style.display = 'block';
            uploadStatus.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>íŒŒì¼ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...</span>
                </div>
            `;
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // ì„±ê³µ ìƒíƒœ í‘œì‹œ
                    uploadStatus.className = 'upload-status success';
                    uploadStatus.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-check-circle"></i>
                            <span>ìŒì„± íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.</span>
                        </div>
                    `;

                    // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
                    resultSection.style.display = 'block';
                    document.getElementById('textResult').textContent = data.text;
                    document.getElementById('summaryResult').innerHTML = marked.parse(data.summary);

                    // ì±—ë´‡ì— ë©”ì‹œì§€ ì¶”ê°€
                    addMessage('íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ íŒŒì¼ ë‚´ìš©ì— ëŒ€í•´ ì§ˆë¬¸í•´ì£¼ì„¸ìš”!', 'assistant');
                    addMessage(`íŒŒì¼ ë‚´ìš© ìš”ì•½:\n${data.summary}`, 'assistant');

                    // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
                    fileInput.value = '';
                    document.getElementById('selectedFileName').style.display = 'none';
                } else {
                    // ì˜¤ë¥˜ ìƒíƒœ í‘œì‹œ
                    uploadStatus.className = 'upload-status error';
                    uploadStatus.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>${data.error || 'íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}</span>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Upload error:', error);
                uploadStatus.className = 'upload-status error';
                uploadStatus.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-exclamation-circle"></i>
                        <span>íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>
                    </div>
                `;
            } finally {
                // ì—…ë¡œë“œ ë²„íŠ¼ ë³µì›
                uploadButton.disabled = false;
                uploadButton.innerHTML = '<i class="fas fa-upload"></i> ì—…ë¡œë“œ';
            }
        });

        // íŒŒì¼ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
        function downloadText() {
            const text = document.getElementById('textResult').textContent;
            if (text) {
                const blob = new Blob([text], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'lecture_text.txt';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showToast('í…ìŠ¤íŠ¸ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                showToast('ë‹¤ìš´ë¡œë“œí•  í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        function downloadSummary() {
            const summary = document.getElementById('summaryResult').textContent;
            if (summary) {
                const blob = new Blob([summary], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'lecture_summary.txt';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showToast('ìš”ì•½ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                showToast('ë‹¤ìš´ë¡œë“œí•  ìš”ì•½ì´ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Enter í‚¤ë¡œ ë©”ì‹œì§€ ì „ì†¡
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // ë³´ë‚´ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        document.getElementById('sendButton').addEventListener('click', () => {
            sendMessage();
        });

        // ë§ˆì§€ë§‰ ì§ˆë¬¸ ìš”ì•½
        async function summarizeLastQuestion() {
            // ì…ë ¥ì°½ê³¼ ë²„íŠ¼ ë¹„í™œì„±í™”
            userInput.disabled = true;
            document.querySelector('.chat-input button').disabled = true;
            document.querySelector('.quick-actions button').disabled = true;

            // ë¡œë”© ë©”ì‹œì§€ ì¶”ê°€
            const loadingMessage = document.createElement("div");
            loadingMessage.className = "loading-message";
            loadingMessage.innerHTML = `
                <span>ë‹µë³€ì„ ìƒì„±í•˜ê³  ìš”ì•½í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤</span>
                <div class="loading-dots">
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                </div>
            `;
            chatMessages.appendChild(loadingMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                const response = await fetch('/summarize_last', {
                    method: 'GET'
                });
                
                const data = await response.json();
                
                // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                loadingMessage.remove();
                
                if (data.error) {
                    addMessage(data.error, 'assistant');
                    return;
                }
                
                let message = `<div class="summary-container">
                    <h3>ğŸ“ ìš”ì•½</h3>
                    <div class="summary-content">${data.summary}</div>
                </div>`;
                
                addMessage(message, 'assistant');
                
            } catch (error) {
                loadingMessage.remove();
                console.error('ì˜¤ë¥˜:', error);
                addMessage('ìš”ì•½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'assistant');
            } finally {
                // ì…ë ¥ì°½ê³¼ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                userInput.disabled = false;
                document.querySelector('.chat-input button').disabled = false;
                document.querySelector('.quick-actions button').disabled = false;
                userInput.focus();
            }
        }

        // ìœ„í‚¤ë°±ê³¼ ê²€ìƒ‰ í•¨ìˆ˜
        async function searchWiki() {
            // ì…ë ¥ì°½ê³¼ ë²„íŠ¼ ë¹„í™œì„±í™”
            userInput.disabled = true;
            document.querySelector('.chat-input button').disabled = true;
            document.querySelector('.quick-actions button').disabled = true;

            // ë¡œë”© ë©”ì‹œì§€ ì¶”ê°€
            const loadingMessage = document.createElement("div");
            loadingMessage.className = "loading-message";
            loadingMessage.innerHTML = `
                <span>ìœ„í‚¤ë°±ê³¼ë¥¼ ê²€ìƒ‰í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤</span>
                <div class="loading-dots">
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                </div>
            `;
            chatMessages.appendChild(loadingMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                const response = await fetch('/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                loadingMessage.remove();
                
                if (data.error) {
                    addMessage(data.error, 'assistant');
                    return;
                }
                
                // ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë©”ì‹œì§€ë¡œ í‘œì‹œ
                addMessage(data.response, 'assistant');
                
            } catch (error) {
                loadingMessage.remove();
                console.error('ì˜¤ë¥˜:', error);
                addMessage('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'assistant');
            } finally {
                // ì…ë ¥ì°½ê³¼ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                userInput.disabled = false;
                document.querySelector('.chat-input button').disabled = false;
                document.querySelector('.quick-actions button').disabled = false;
                userInput.focus();
            }
        }

        // ë²ˆì—­ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ìˆ˜ì •
        document.getElementById('translateBtn').addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // ê¸°ì¡´ ë©”ë‰´ê°€ ìˆë‹¤ë©´ ì œê±°
            const existingMenu = document.querySelector('.language-menu');
            if (existingMenu) {
                existingMenu.remove();
                return;
            }
            
            // ë§ˆì§€ë§‰ ë©”ì‹œì§€ í™•ì¸
            const messages = document.querySelectorAll('.message');
            if (messages.length === 0) {
                showToast('ë²ˆì—­í•  ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const lastMessage = messages[messages.length - 1];
            if (!lastMessage.classList.contains('assistant-message')) {
                showToast('ë§ˆì§€ë§‰ ë©”ì‹œì§€ê°€ ì–´ì‹œìŠ¤í„´íŠ¸ì˜ ë©”ì‹œì§€ê°€ ì•„ë‹™ë‹ˆë‹¤.');
                return;
            }
            
            // ì–¸ì–´ ì„ íƒ ë©”ë‰´ ìƒì„±
            const menu = document.createElement('div');
            menu.className = 'language-menu';
            menu.innerHTML = `
                <div class="language-option" data-lang="en">EN</div>
                <div class="language-option" data-lang="zh-Hans">ä¸­</div>
                <div class="language-option" data-lang="ja">æ—¥</div>
            `;
            
            // ë©”ë‰´ ìœ„ì¹˜ ì„¤ì •
            const translateBtn = document.getElementById('translateBtn');
            const buttonRect = translateBtn.getBoundingClientRect();
            menu.style.position = 'absolute';
            menu.style.left = `${buttonRect.left}px`;
            menu.style.top = `${buttonRect.bottom + 5}px`;
            document.body.appendChild(menu);
            
            // ì–¸ì–´ ì„ íƒ ì´ë²¤íŠ¸
            menu.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', async function() {
                    const targetLang = this.getAttribute('data-lang');
                    const messageContent = lastMessage.querySelector('.message-content');
                    
                    if (!messageContent) {
                        showToast('ë²ˆì—­í•  ë©”ì‹œì§€ ë‚´ìš©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }
                    
                    // ë©”ì‹œì§€ í…ìŠ¤íŠ¸ ì¶”ì¶œ
                    const text = messageContent.textContent || messageContent.innerText;
                    if (!text.trim()) {
                        showToast('ë²ˆì—­í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }
                    
                    try {
                        // ë¡œë”© ë©”ì‹œì§€ ì¶”ê°€
                        const loadingMessage = document.createElement("div");
                        loadingMessage.className = "loading-message";
                        loadingMessage.innerHTML = `
                            <span>ë²ˆì—­ ì¤‘ì…ë‹ˆë‹¤</span>
                            <div class="loading-dots">
                                <div class="loading-dot"></div>
                                <div class="loading-dot"></div>
                                <div class="loading-dot"></div>
                            </div>
                        `;
                        chatMessages.appendChild(loadingMessage);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                        
                        // ë²ˆì—­ ìš”ì²­
                        const response = await fetch('/translate', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ 
                                text: text,
                                target_lang: targetLang
                            })
                        });
                        
                        if (!response.ok) {
                            throw new Error('ë²ˆì—­ ìš”ì²­ ì‹¤íŒ¨');
                        }
                        
                        const data = await response.json();
                        
                        // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                        loadingMessage.remove();
                        
                        if (data.translated) {
                            // ë²ˆì—­ëœ ë©”ì‹œì§€ ìƒì„±
                            const translatedMessage = document.createElement('div');
                            translatedMessage.className = 'message assistant-message';
                            
                            // ë©”ì‹œì§€ ë‚´ìš© ì¶”ê°€
                            const messageContent = document.createElement('div');
                            messageContent.className = 'message-content';
                            messageContent.innerHTML = marked.parse(data.translated);
                            translatedMessage.appendChild(messageContent);
                            
                            // ìŠ¤í”¼ì»¤ ì•„ì´ì½˜ ì¶”ê°€
                            const speakerIcon = document.createElement("div");
                            speakerIcon.className = "speaker-icon";
                            speakerIcon.innerHTML = '<i class="fas fa-volume-up"></i>';
                            
                            // TTS ê¸°ëŠ¥ ì¶”ê°€
                            speakerIcon.addEventListener('click', async function() {
                                try {
                                    const ttsResponse = await fetch('/tts', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({ text: data.translated })
                                    });
                                    
                                    if (ttsResponse.ok) {
                                        const ttsData = await ttsResponse.json();
                                        if (ttsData.audio_url) {
                                            const audio = new Audio(ttsData.audio_url);
                                            audio.play();
                                        }
                                    }
                                } catch (error) {
                                    console.error('TTS error:', error);
                                    showToast('ìŒì„± ì¬ìƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                                }
                            });
                            
                            translatedMessage.appendChild(speakerIcon);
                            chatMessages.appendChild(translatedMessage);
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                        } else {
                            throw new Error(data.error || 'ë²ˆì—­ ì‹¤íŒ¨');
                        }
                    } catch (error) {
                        console.error('Translation error:', error);
                        showToast('ë²ˆì—­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    } finally {
                        menu.remove();
                    }
                });
            });
            
            // ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            const closeMenu = function(e) {
                if (!menu.contains(e.target) && e.target !== translateBtn) {
                    menu.remove();
                    document.removeEventListener('click', closeMenu);
                }
            };
            
            setTimeout(() => {
                document.addEventListener('click', closeMenu);
            }, 0);
        });

        // ì´ë¯¸ì§€ ìƒì„± ê¸°ëŠ¥
        async function generateImage() {
            try {
                // ë¡œë”© ë©”ì‹œì§€ ì¶”ê°€
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'message assistant';
                loadingDiv.innerHTML = `
                    <div class="loading-message">
                        <span>ê·¸ë¦¼ì„ ìƒì„±ì¤‘ì…ë‹ˆë‹¤</span>
                        <div class="loading-dots">
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                        </div>
                    </div>
                `;
                chatMessages.appendChild(loadingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                const response = await fetch('/generate_image', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                chatMessages.removeChild(loadingDiv);

                if (data.error) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message system';
                    messageDiv.innerHTML = marked.parse(data.error);
                    chatMessages.appendChild(messageDiv);
                } else {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message assistant';
                    messageDiv.innerHTML = `
                        <p>í‚¤ì›Œë“œ "${data.keyword}"ì— ëŒ€í•œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤:</p>
                        <img src="${data.image_url}" alt="Generated image" style="max-width: 100%; border-radius: 8px; margin-top: 10px;">
                    `;
                    chatMessages.appendChild(messageDiv);
                }

                chatMessages.scrollTop = chatMessages.scrollHeight;
            } catch (error) {
                console.error('Error generating image:', error);
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message system';
                messageDiv.innerHTML = marked.parse('ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                chatMessages.appendChild(messageDiv);
            }
        }

        // ìŒì„± ì¸ì‹ ê¸°ëŠ¥
        let recognition = null;
        let isRecording = false;

        // ë§ˆì´í¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('micButton').addEventListener('click', () => {
            if (!recognition) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'ko-KR';
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onresult = (event) => {
                    const text = event.results[0][0].transcript;
                    document.getElementById('userInput').value = text;
                    sendMessage();
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    alert('ìŒì„± ì¸ì‹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + event.error);
                    stopRecording();
                };

                recognition.onend = () => {
                    stopRecording();
                };
            }

            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        });

        function startRecording() {
            try {
                recognition.start();
                isRecording = true;
                document.getElementById('micButton').classList.add('recording');
                document.getElementById('micButton').innerHTML = '<i class="fas fa-stop"></i>';
            } catch (error) {
                console.error('Failed to start recording:', error);
                alert('ìŒì„± ë…¹ìŒì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§ˆì´í¬ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        function stopRecording() {
            if (recognition) {
                recognition.stop();
            }
            isRecording = false;
            document.getElementById('micButton').classList.remove('recording');
            document.getElementById('micButton').innerHTML = '<i class="fas fa-microphone"></i>';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë§ˆì´í¬ ê¶Œí•œ ìš”ì²­
        window.addEventListener('load', () => {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(() => {
                        console.log('Microphone access granted');
                    })
                    .catch((error) => {
                        console.error('Microphone access denied:', error);
                        alert('ë§ˆì´í¬ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ìŒì„± ì…ë ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                    });
            } else {
                console.error('Speech recognition not supported');
                document.getElementById('micButton').style.display = 'none';
            }
        });
    </script>
</body>
</html> 